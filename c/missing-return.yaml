rules:
  - id: raptor-missing-return
    metadata:
      author: Marco Ivaldi <raptor@0xdeadbeef.info>
      references:
        - https://cwe.mitre.org/data/definitions/393
        - https://cwe.mitre.org/data/definitions/394
      confidence: MEDIUM
      # NOTE: C++ class declarations should also be excluded, but
      # apparently this pattern is not supported by Semgrep.
    message: >-
      A non-void function does not have a return statement. Hence, its
      return value can be considered undefined.
    severity: WARNING
    languages:
      - c
      - cpp
    patterns:
      - pattern: |
          $TYPE $FUN(...) { ... }
      # exclude function declarations
      - pattern-not: |
          $TYPE $FUN(...);
      # exclude functions with return statement
      - pattern-not: |
          $TYPE $FUN(...) { ... return $RET; }
      # exclude void functions
      - pattern-not: |
          ... void $FUN(...) { ... }
      # exclude main function
      - pattern-not: |
          int main(...) { ... }
      # exclude else if (disabled for performance reasons)
        # - pattern-not-inside: |
        #    ... if ($COND) { ... }
