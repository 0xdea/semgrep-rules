rules:
  - id: unterminated-string-strncpy-stpncpy
    metadata:
      author: Marco Ivaldi <raptor@0xdeadbeef.info>
      references:
        - https://cwe.mitre.org/data/definitions/170
      confidence: MEDIUM
    message: >-
      If there is no NUL character byte in the first n bytes of the source
      string, strncpy() and stpncpy() do not null-terminate the destination
      buffer. If the program does not explicitly terminate the destination
      buffer, this will almost certainly result in information disclosure,
      and possibly a buffer overflow condition, which may be exploited to
      execute arbitrary code.
    severity: WARNING
    languages:
      - c
      - cpp
    pattern-either:
      - patterns:
          - pattern: strncpy(...)
          - pattern-not-inside: |
              strncpy($DST, $SRC, $N);
              ...
              $DST[$POS] = NULL;
          - pattern-not-inside: |
              strncpy($DST, $SRC, $N);
              ...
              $DST[$POS] = '\0';
          - pattern-not-inside: |
              strncpy($DST, $SRC, $N);
              ...
              $DST[$POS] = 0;
      - patterns:
          - pattern: stpncpy(...)
          - pattern-not-inside: |
              stpncpy($DST, $SRC, $N);
              ...
              $DST[$POS] = NULL;
          - pattern-not-inside: |
              stpncpy($DST, $SRC, $N);
              ...
              $DST[$POS] = '\0';
          - pattern-not-inside: |
              stpncpy($DST, $SRC, $N);
              ...
              $DST[$POS] = 0;
