rules:
  - id: raptor-insecure-api-access-stat
    metadata:
      author: Marco Ivaldi <raptor@0xdeadbeef.info>
      references:
        - https://cwe.mitre.org/data/definitions/367
        - https://g.co/kgs/PCHQjJ
        - https://labs.snyk.io/resources/leaky-vessels-container-vuln-deep-dive/
      confidence: HIGH
      # NOTE: `_stat` and `_lstat` are not covered.
      # NOTE: refer also to `cpp.lang.security.filesystem.*` for stricter
      # check/action patterns.
    message: >-
      The software checks the state of a resource before using it, but the 
      resource's state can change between the check and the use in a way that 
      invalidates the results of the check. This can cause the software to 
      perform invalid actions when the resource is in an unexpected state.
    severity: WARNING
    languages:
      - c
      - cpp
    pattern-either:
      - pattern: access(...)
      - pattern: faccessat(...)
      - pattern: faccessat2(...)
      - pattern: stat(...)
      - pattern: lstat(...)
      - pattern: fstatat(...)
